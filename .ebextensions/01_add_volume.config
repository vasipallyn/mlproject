commands:
  01_setup_extra_volume:
    command: |
      echo "Setting up extra 20GB EBS volume for /mnt/temp..."
      DEVICES=$(lsblk -o NAME,TYPE -n | grep disk | awk '{print $1}')
      for DEV in $DEVICES; do
        if ! mount | grep -q "/dev/$DEV"; then
          echo "Found unmounted device: /dev/$DEV"
          mkfs -t ext4 /dev/$DEV || true
          mkdir -p /mnt/temp
          mount /dev/$DEV /mnt/temp || true
          chmod 1777 /mnt/temp
          echo "/dev/$DEV /mnt/temp ext4 defaults,nofail 0 2" >> /etc/fstab
          export TMPDIR=/mnt/temp
          echo "export TMPDIR=/mnt/temp" >> /etc/profile.d/tmpdir.sh
          break
        fi
      done
